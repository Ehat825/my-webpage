<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Interactive Bar Chart</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
  <!-- Dropdowns for choosing variables -->
  <div>
    <label for="yVariable">Select Score Variable:</label>
    <select id="yVariable">
      <option value="math_score">Math Score</option>
      <option value="reading_score">Reading Score</option>
      <option value="writing_score">Writing Score</option>
      <option value="total_score">Total Score</option>
      <option value="average_score">Average Score</option>
    </select>

    <label for="xVariable">Select Category:</label>
    <select id="xVariable">
      <option value="gender">Gender</option>
      <option value="race_ethnicity">Race/Ethnicity</option>
      <option value="parental_level_of_education">Parental Education Level</option>
      <option value="lunch">Lunch</option>
      <option value="test_preparation_course">Test Preparation</option>
    </select>
  </div>

  <svg width="600" height="400"></svg>

  <script>
    const svg = d3.select("svg");
    const width = svg.attr("width");
    const height = svg.attr("height");
    const margin = {top: 20, right: 20, bottom: 50, left: 60};

// Load data
d3.csv("your_data.csv").then(data => {
  // Parse numeric values
  data.forEach(d => {
    d.math_score = +d.math_score;
    d.reading_score = +d.reading_score;
    d.writing_score = +d.writing_score;
    d.total_score = +d.total_score;
    d.average_score = +d.average_score;
  });

  // Initial variables for y and x
  let yVar = "math_score";
  let xVar = "parental_level_of_education";

  // Function to calculate averages and update chart
  function updateChart() {
    // Group data by selected x-variable and calculate average for y-variable
    const groupedData = Array.from(
      d3.rollup(
        data,
        v => d3.mean(v, d => d[yVar]),  // Calculate mean of the selected yVar for each group
        d => d[xVar]                    // Group by the selected xVar
      ),
      ([key, value]) => ({ xCategory: key, yValue: value })  // Convert Map to array of objects
    );

    // Update scales
    const xScale = d3.scaleBand()
      .domain(groupedData.map(d => d.xCategory))
      .range([margin.left, width - margin.right])
      .padding(0.1);

    const yScale = d3.scaleLinear()
      .domain([0, d3.max(groupedData, d => d.yValue)])
      .nice()
      .range([height - margin.bottom, margin.top]);

    // Remove old elements
    svg.selectAll("*").remove();

    // X Axis
    svg.append("g")
      .attr("transform", `translate(0,${height - margin.bottom})`)
      .call(d3.axisBottom(xScale))
      .selectAll("text")
      .attr("transform", "rotate(-45)")
      .style("text-anchor", "end");

    // Y Axis
    svg.append("g")
      .attr("transform", `translate(${margin.left},0)`)
      .call(d3.axisLeft(yScale));

    // Bars
    svg.selectAll("rect")
      .data(groupedData)
      .enter()
      .append("rect")
      .attr("x", d => xScale(d.xCategory))
      .attr("y", d => yScale(d.yValue))
      .attr("width", xScale.bandwidth())
      .attr("height", d => height - margin.bottom - yScale(d.yValue))
      .attr("fill", "steelblue");
  }

  // Initialize chart
  updateChart();

  // Event listeners for dropdowns
  d3.select("#yVariable").on("change", function() {
    yVar = this.value;
    updateChart(); // Update chart when y-axis variable changes
  });

  d3.select("#xVariable").on("change", function() {
    xVar = this.value;
    updateChart(); // Update chart when x-axis variable changes
  });
});

  </script>
</body>
</html>
